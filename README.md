# Multi-Tenant CRM System

–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è CRM —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–ª–∏—â–Ω–æ-–∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏ (–ñ–ö–•) —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π "–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç–∞".

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ **"Database per Tenant"** - –∫–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç (—Ç–µ–Ω–∞–Ω—Ç) –∏–º–µ–µ—Ç —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (`central_crm`) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤** (`tenant_*`) - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- **Laravel + Filament** - backend –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –°–£–ë–î —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSONB

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –ë–î
- ‚úÖ –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –æ—á–∏—Å—Ç–∫–æ–π –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —á–µ—Ä–µ–∑ JSONB

### –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä–∑–∏–Ω—ã:
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∏–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫—Ç–æ —É–¥–∞–ª–∏–ª –∏ –∫–æ–≥–¥–∞
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ë–î —á–µ—Ä–µ–∑ middleware
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ Filament

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 8.1+
- PostgreSQL 13+
- Composer
- Node.js & NPM (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone git@github.com:ataizhu/multi_tenant_crm.git
cd multi_tenant_crm
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
composer install
npm install
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp .env.example .env
php artisan key:generate
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
```sql
CREATE DATABASE central_crm;
CREATE USER postgres WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE central_crm TO postgres;
```

–û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª:
```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=central_crm
DB_USERNAME=postgres
DB_PASSWORD=your_password
```

### 5. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
php artisan migrate
```

### 6. –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```bash
php artisan make:filament-user
```

### 7. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
php artisan serve
```

–û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:8000/admin –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ Filament/Resources/           # Filament —Ä–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ TenantResource.php       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ TenantTrashResource.php  # –ö–æ—Ä–∑–∏–Ω–∞ —Ç–µ–Ω–∞–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ Http/Middleware/             # Middleware
‚îÇ   ‚îî‚îÄ‚îÄ InitializeTenancy.php   # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ë–î –ø–æ –¥–æ–º–µ–Ω—É
‚îú‚îÄ‚îÄ Models/                      # Eloquent –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ Tenant.php              # –ú–æ–¥–µ–ª—å —Ç–µ–Ω–∞–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ TenantTrash.php         # –ú–æ–¥–µ–ª—å –∫–æ—Ä–∑–∏–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ User.php                # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îî‚îÄ‚îÄ Services/                    # –°–µ—Ä–≤–∏—Å—ã
    ‚îî‚îÄ‚îÄ TenantService.php       # –õ–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏

database/
‚îú‚îÄ‚îÄ migrations/                  # –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ 2025_10_20_161848_create_tenants_table.php
‚îî‚îÄ‚îÄ migrations/tenant/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ë–î —Ç–µ–Ω–∞–Ω—Ç–æ–≤
    ‚îî‚îÄ‚îÄ 2025_10_20_164207_create_subscribers_table.php
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ë–î (`central_crm`)

**–¢–∞–±–ª–∏—Ü–∞ `tenants`:**
- `id` - ID —Ç–µ–Ω–∞–Ω—Ç–∞
- `name` - –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `domain` - –î–æ–º–µ–Ω —Ç–µ–Ω–∞–Ω—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `database` - –ò–º—è –ë–î —Ç–µ–Ω–∞–Ω—Ç–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ)
- `settings` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ JSONB —Ñ–æ—Ä–º–∞—Ç–µ
- `status` - –°—Ç–∞—Ç—É—Å (active/inactive/suspended)
- `deleted` - –§–ª–∞–≥ –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- `timestamps` - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

**–¢–∞–±–ª–∏—Ü–∞ `tenant_trash`:**
- `id` - ID –∑–∞–ø–∏—Å–∏ –∫–æ—Ä–∑–∏–Ω—ã
- `tenant_id` - –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç–∞
- `deleted_by` - –ö—Ç–æ —É–¥–∞–ª–∏–ª
- `deleted_at` - –ö–æ–≥–¥–∞ —É–¥–∞–ª–µ–Ω
- `deletion_reason` - –ü—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
- `timestamps` - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

### –ë–î —Ç–µ–Ω–∞–Ω—Ç–æ–≤ (`tenant_*`)

**–¢–∞–±–ª–∏—Ü–∞ `subscribers`:**
- `id` - ID –∞–±–æ–Ω–µ–Ω—Ç–∞
- `name` - –ò–º—è –∞–±–æ–Ω–µ–Ω—Ç–∞
- `address` - –ê–¥—Ä–µ—Å
- `phone` - –¢–µ–ª–µ—Ñ–æ–Ω
- `email` - Email
- `status` - –°—Ç–∞—Ç—É—Å –∞–±–æ–Ω–µ–Ω—Ç–∞
- `balance` - –ë–∞–ª–∞–Ω—Å
- `timestamps` - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

## üîÑ Workflow —Å–∏—Å—Ç–µ–º—ã

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `tenants`
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ë–î `tenant_*`
3. –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ë–î —Ç–µ–Ω–∞–Ω—Ç–∞
4. –¢–µ–Ω–∞–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞:
1. **–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**: –∑–∞–ø–∏—Å—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `deleted=true`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `tenant_trash` —Å –ø—Ä–∏—á–∏–Ω–æ–π —É–¥–∞–ª–µ–Ω–∏—è
3. –ë–î —Ç–µ–Ω–∞–Ω—Ç–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π
4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: —Ñ–ª–∞–≥ `deleted` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –∑–∞–ø–∏—Å—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã —É–¥–∞–ª—è–µ—Ç—Å—è
5. **–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ**: –ë–î —Ç–µ–Ω–∞–Ω—Ç–∞ —É–¥–∞–ª—è–µ—Ç—Å—è, –∑–∞–ø–∏—Å–∏ –∏–∑ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —É–¥–∞–ª—è—é—Ç—Å—è

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞ —á–µ—Ä–µ–∑ tinker
php artisan tinker
$tenant = new App\Models\Tenant();
$tenant->name = '–ù–æ–≤–∞—è –ñ–ö–•';
$tenant->domain = 'new-zhkh.zhkh.local';
$tenant->database = 'tenant_new_zhkh';
$tenant->status = 'active';
$tenant->save();

# –°–æ–∑–¥–∞–Ω–∏–µ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è —Ç–µ–Ω–∞–Ω—Ç–∞
$tenantService = app(App\Services\TenantService::class);
$tenantService->createTenantDatabase($tenant);
$tenantService->runTenantMigrations($tenant);
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ö–∞–∂–¥—ã–π —Ç–µ–Ω–∞–Ω—Ç –∏–º–µ–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ë–î
- Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –ø–æ –¥–æ–º–µ–Ω—É
- –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ Git (.env, –ø–∞—Ä–æ–ª–∏)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π JSONB –¥–ª—è –≥–∏–±–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º.

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork –ø—Ä–æ–µ–∫—Ç–∞
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add some AmazingFeature'`)
4. Push –≤ branch (`git push origin feature/AmazingFeature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º —Å Laravel –∏ PostgreSQL.